<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${mecanicienName} + ' - Détails'">Mecanicien Details</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .header-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .info-card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .reparation-table {
            font-size: 0.9rem;
        }
        .stat-card {
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
        }
    </style>
</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-dark header-bg">
    <div class="container">
        <a class="navbar-brand" th:href="@{/garages/{id}(id=${garage.id})}">
            <i class="fas fa-arrow-left me-2"></i>
            Retour au Garage: <span th:text="${garage.nom}"></span>
        </a>
        <!-- Add New Mechanic Button -->
        <a th:href="@{/mecaniciens/new/{garageId}(garageId=${garage.id})}" class="btn btn-success">
            <i class="fas fa-plus me-2"></i>Nouveau Mécanicien
        </a>
    </div>
</nav>

<div class="container mt-4">
    <!-- Mecanicien Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card info-card">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-6 text-start">
                            <h1 class="display-5">
                                <i class="fas fa-user me-3 text-primary"></i>
                                <span th:text="${mecanicienName}">Mecanicien Name</span>
                            </h1>
                            <p class="lead mb-0">
                                <i class="fas fa-warehouse me-2 text-muted"></i>
                                <span th:text="${garage.nom}"></span> - <span th:text="${garage.ville}"></span>
                            </p>
                        </div>
                        <div class="col-md-6 text-end">
                            <div class="d-flex justify-content-end align-items-center gap-2">
                                <div th:if="${mecanicien.containsKey('experience')}">
                                <span class="badge bg-info fs-6 p-3 me-3">
                                    <i class="fas fa-star me-2"></i>
                                    <span th:text="${mecanicien.get('experience')}">0</span> ans d'expérience
                                </span>
                                </div>
                                <!-- Edit and Delete Buttons -->
                                <div class="btn-group">
                                    <a th:href="@{/mecaniciens/{garageId}/{mecanicienName}/reparations/new(garageId=${garage.id}, mecanicienName=${mecanicienName})}"
                                       class="btn btn-success">
                                        <i class="fas fa-plus me-1"></i>Nouvelle Réparation
                                    </a>
                                    <a th:href="@{/mecaniciens/edit/{garageId}/{mecanicienName}(garageId=${garage.id}, mecanicienName=${mecanicienName})}"
                                       class="btn btn-warning">
                                        <i class="fas fa-edit me-1"></i>Modifier
                                    </a>
                                    <a th:href="@{/mecaniciens/delete/{garageId}/{mecanicienName}(garageId=${garage.id}, mecanicienName=${mecanicienName})}"
                                       class="btn btn-danger"
                                       onclick="return confirm('Êtes-vous sûr de vouloir supprimer ce mécanicien? Toutes ses réparations seront perdues.')">
                                        <i class="fas fa-trash me-1"></i>Supprimer
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Statistics -->
    <div class="row mb-3" th:if="${mecanicien.containsKey('reparations')}">
        <div class="col-md-4 mb-4">
            <div class="card stat-card">
                <div class="card-body text-center">
                    <h3 th:text="${#lists.size(mecanicien.get('reparations'))}">0</h3>
                    <p class="mb-0">Total Réparations</p>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-4">
            <div class="card stat-card">
                <div class="card-body text-center">
                    <h3 th:text="${#aggregates.sum(mecanicien.get('reparations').?[details != null].![details.duree]) ?:0}">0</h3>
                    <p class="mb-0">Jours de Travail</p>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-4">
            <div class="card stat-card">
                <div class="card-body text-center">
                    <h3 th:text="${#lists.size(mecanicien.get('reparations').?[details != null and details.voiture != null])}">0</h3>
                    <p class="mb-0">Voitures Réparées</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Reparations Table -->
    <div th:if="${mecanicien.containsKey('reparations') and not mecanicien.get('reparations').empty}">
        <div class="table-responsive">
            <table class="table table-hover reparation-table">
                <thead class="table-dark">
                <tr>
                    <th>Type</th>
                    <th>Date</th>
                    <th>Coût (€)</th>
                    <th>Voiture</th>
                    <th>Durée</th>
                    <th>Actions</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="reparation, stat : ${mecanicien.get('reparations')}">
                    <td>
                        <strong th:text="${reparation.get('type')}">Type</strong>
                    </td>
                    <td th:text="${reparation.get('date')}">Date</td>
                    <td>
                        <span class="fw-bold text-success" th:text="${reparation.get('cout')} + ' €'">Cost</span>
                    </td>
                    <td>
                        <span th:if="${reparation.containsKey('details') and reparation.get('details').containsKey('voiture')}">
                            <span class="fw-bold" th:text="${reparation.get('details').get('voiture').get('marque')}"></span>
                            <span th:text="${reparation.get('details').get('voiture').get('modele')}"></span>
                        </span>
                        <span th:unless="${reparation.containsKey('details') and reparation.get('details').containsKey('voiture')}">
                            <em class="text-muted">Non spécifié</em>
                        </span>
                    </td>
                    <td>
                        <span th:if="${reparation.containsKey('details') and reparation.get('details').containsKey('duree')}">
                            <span class="badge bg-primary" th:text="${reparation.get('details').get('duree')} + ' j'"></span>
                        </span>
                        <span th:unless="${reparation.containsKey('details') and reparation.get('details').containsKey('duree')}">
                            <em class="text-muted">N/A</em>
                        </span>
                    </td>
                    <td>
                        <a th:href="@{/mecaniciens/{garageId}/{mecanicienName}/reparations/delete/{index}(garageId=${garage.id}, mecanicienName=${mecanicienName}, index=${stat.index})}"
                           class="btn btn-outline-danger btn-sm"
                           onclick="return confirm('Êtes-vous sûr de vouloir supprimer cette réparation?')">
                            <i class="fas fa-trash"></i>
                        </a>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
    <div th:if="${not mecanicien.containsKey('reparations') or mecanicien.get('reparations').empty}">
        <div class="text-center py-5">
            <div class="empty-state">
                <i class="fas fa-wrench fa-4x text-muted mb-4"></i>
                <h4 class="text-muted mb-3">Aucune réparation enregistrée</h4>
                <p class="text-muted mb-4">Ce mécanicien n'a encore effectué aucune réparation.</p>
                <a th:href="@{/mecaniciens/{garageId}/{mecanicienName}/reparations/new(garageId=${garage.id}, mecanicienName=${mecanicienName})}"
                   class="btn btn-primary btn-lg">
                    <i class="fas fa-plus me-2"></i>Ajouter la première réparation
                </a>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>